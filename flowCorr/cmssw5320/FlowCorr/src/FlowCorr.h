#include "TComplex.h"
#include <vector>
#include <TVector3.h>

#define nCentBin 14
#define nHarmonics 8
#define nPtBin 20 

using namespace std;
using namespace reco;
using namespace edm;

  bool useReDenominator = true;
  bool useRe = true;
  double cBin[nCentBin+1]={0,5,10,15,20,25,30,35,40,50,60,70,80,90,100};
  double ptBin[nPtBin+1]={0.3, 0.4, 0.5, 0.6, 0.8, 1.0, 1.25, 1.5, 2.0, 2.5, 3.0, 3.5, 4.0, 5.0, 6.0, 7.0, 8.0, 10.0, 12.0, 14.0, 20.0};
  TComplex QhfPlus[nCentBin][nHarmonics];
  TComplex QhfMinus[nCentBin][nHarmonics];
  TComplex Qhf2p2Plus[nCentBin];
  TComplex Qhf2p2Minus[nCentBin];
  TComplex Qhf2p3Plus[nCentBin];
  TComplex Qhf2p3Minus[nCentBin];
  TComplex Qhf3p3Plus[nCentBin];
  TComplex Qhf3p3Minus[nCentBin];
  TComplex Qhf2p2p2Plus[nCentBin];
  TComplex Qhf2p2p2Minus[nCentBin];
  TComplex Qhf2p2p3Plus[nCentBin];
  TComplex Qhf2p2p3Minus[nCentBin];
  double sumWPlus[nCentBin];
  double sumW2Plus[nCentBin];
  double sumW3Plus[nCentBin];
  double sumWMinus[nCentBin];
  double sumW2Minus[nCentBin];
  double sumW3Minus[nCentBin];
  TComplex QtrkPlus[nCentBin][nHarmonics];
  TComplex QtrkMinus[nCentBin][nHarmonics];
  TComplex QtrkAll[nCentBin][nHarmonics];
  double VnAbs2[nCentBin][nHarmonics]={{0.0},{0.0}};
  double VnAbs4[nCentBin][nHarmonics]={{0.0},{0.0}};
  double VnAbs6[nCentBin][nHarmonics]={{0.0},{0.0}};
  double V2Abs2V3Abs2[nCentBin]={0.0};
  double V2Abs4V3Abs2[nCentBin]={0.0};
  double V4V2starV2star[nCentBin]={0.0};
  double V6V2starV2starV2star[nCentBin]={0.0};
  double V6V3starV3star[nCentBin]={0.0};
  double V5V2starV3star[nCentBin]={0.0};
  double V7V2starV2starV3star[nCentBin]={0.0};
  double v2Psi2[nCentBin]={0.0};
  double v3Psi3[nCentBin]={0.0};
  double v4Psi2[nCentBin]={0.0};
  double v4Psi4[nCentBin]={0.0};
  double v6Psi2[nCentBin]={0.0};
  double v6Psi3[nCentBin]={0.0};
  double v6Psi6[nCentBin]={0.0};
  double v5Psi2Psi3[nCentBin]={0.0};
  double v7Psi2Psi3[nCentBin]={0.0};
  int nEvent[nCentBin]={0};

  vector<TVector3> *pVect_trkEtaPlus;
  vector<TVector3> *pVect_trkEtaMinus;  
  vector<TVector3> *pVect_hfEtaPlus;
  vector<TVector3> *pVect_hfEtaMinus;  

  TH1D* hMultTrkEtaPlus;
  TH1D* hMultTrkEtaMinus;
  TH1D* hMultHFEtaPlus;
  TH1D* hMultHFEtaMinus;
  TH1D* hQhfPlusX[nCentBin][nHarmonics];
  TH1D* hQhfPlusY[nCentBin][nHarmonics];
  TH1D* hQhfPlusQ[nCentBin][nHarmonics];
  TH1D* hQhfMinusX[nCentBin][nHarmonics];
  TH1D* hQhfMinusY[nCentBin][nHarmonics];
  TH1D* hQhfMinusQ[nCentBin][nHarmonics];
  TH1D* hVnAbs2[nCentBin][nHarmonics];
  TH1D* hVnAbs4[nCentBin][nHarmonics];
  TH1D* hVnAbs6[nCentBin][nHarmonics];
  TH1D* hVnAbs8[nCentBin][nHarmonics];
  TH1D* hV2Abs2V3Abs2[nCentBin];
  TH1D* hV2Abs4V3Abs2[nCentBin];
  TH1D* hV2Abs2V3Abs4[nCentBin];
  //trk 
  TH1D* hV2Abs4trk1[nCentBin];
  TH1D* hV2Abs6trk1[nCentBin];
  TH1D* hV3Abs4trk1[nCentBin];
  TH1D* hV2Abs2V3Abs2trk1[nCentBin];
  TH1D* hV2Abs4V3Abs2trk1[nCentBin];
  TH1D* hV2Abs4trk12[nCentBin];
  TH1D* hV2Abs6trk12[nCentBin];
  TH1D* hV3Abs4trk12[nCentBin];
  TH1D* hV2Abs2V3Abs2trk12[nCentBin];
  TH1D* hV2Abs4V3Abs2trk12[nCentBin];
  TH1D* hV2Abs4trk2[nCentBin];
  TH1D* hV2Abs6trk2[nCentBin];
  TH1D* hV3Abs4trk2[nCentBin];
  TH1D* hV2Abs2V3Abs2trk2[nCentBin];
  TH1D* hV2Abs4V3Abs2trk2[nCentBin];

  TH1D* hV2V2star[nCentBin];
  TH1D* hV4V2starV2star[nCentBin];
  TH1D* hV6V2starV2starV2star[nCentBin];
  TH1D* hV6V3starV3star[nCentBin];
  TH1D* hV5V2starV3star[nCentBin];
  TH1D* hV7V2starV2starV3star[nCentBin];

  TH1D* hv2V2star[nCentBin][nPtBin];
  TH1D* hv3V3star[nCentBin][nPtBin];
  TH1D* hv4V4star[nCentBin][nPtBin];
  TH1D* hv5V5star[nCentBin][nPtBin];
  TH1D* hv6V6star[nCentBin][nPtBin];
  TH1D* hv7V7star[nCentBin][nPtBin];
  TH1D* hv8V8star[nCentBin][nPtBin];
  TH1D* hv4V2starV2star[nCentBin][nPtBin];
  TH1D* hv4V2starV2starAB[nCentBin][nPtBin];
  TH1D* hv4V2starV2starSub[nCentBin][nPtBin];
  TH1D* hv6V2starV2starV2star[nCentBin][nPtBin];
  TH1D* hv6V2starV2starV2starAB[nCentBin][nPtBin];
  TH1D* hv6V2starV2starV2starSub[nCentBin][nPtBin];
  TH1D* hv6V3starV3star[nCentBin][nPtBin];
  TH1D* hv6V3starV3starAB[nCentBin][nPtBin];
  TH1D* hv6V3starV3starSub[nCentBin][nPtBin];
  TH1D* hv5V2starV3star[nCentBin][nPtBin];
  TH1D* hv5V2starV3starAB[nCentBin][nPtBin];
  TH1D* hv5V2starV3starSub[nCentBin][nPtBin];
  TH1D* hv7V2starV2starV3star[nCentBin][nPtBin];
  TH1D* hv7V2starV2starV3starAB[nCentBin][nPtBin];
  TH1D* hv7V2starV2starV3starSub[nCentBin][nPtBin];
  TH1D* hv8V2starV2starV2starV2star[nCentBin][nPtBin];
  TH1D* hv8V2starV3starV3star[nCentBin][nPtBin];

  TH1D* hMeanPt[nCentBin][nPtBin];


   TH1D* hCent;
   TH1D* hHF;
   TH1D* hAngle;
   TH1D* hAngleFlat;
   TH1D* hvz;
   TH1D* hvx;
   TH1D* hvy;
   TH1D* hNtrks;
   TH1D* hpt;
   TH1D* heta;
   TH1D* hphi;
   TH1D* hHFcal;


/*
double meanQxPlus[nCentBin][nHarmonics] = {{0.00199748, -0.00408004, 0.000246719, -0.000881641, 0.000978662, -0.0014814, 0.000915193, -0.00401976}, 
{0.00127759, -0.00403468, 0.000395149, -0.0013374, 0.00107663, -0.00135432, 0.000900699, -0.00393073}, 
{0.000200482, -0.00375178, 0.000458602, -0.00164834, 0.000990024, -0.00128934, 0.000922069, -0.00363904}, 
{-0.00106744, -0.00337196, 0.000642424, -0.00191812, 0.000875069, -0.00104168, 0.000893524, -0.00338529}, 
{-0.0040496, -0.00218604, 0.000987658, -0.00274488, 0.000513334, -0.00055493, 0.000802327, -0.00274905}, 
{-0.00771195, -0.0014174, 0.00147953, -0.00336639, 0.000346875, -0.00029258, 0.000621825, -0.00162792}, 
{-0.00914771, -0.000652144, 0.00159159, -0.00412941, 1.80143e-05, 0.000454485, 0.000978051, -0.00123499}, 
{-0.011203, 0.000567692, 0.00202527, -0.00464559, 2.12352e-05, 0.00108298, 0.00117886, -0.000763904}, 
{-0.0139645, 0.00182475, 0.00271231, -0.00541595, -0.000367885, 0.00137365, 0.000778927, -0.00024179}, 
{-0.0173002, 0.0030182, 0.0033854, -0.00609639, -0.000446519, 0.00130209, 0.000873207, 0.000672242}, 
{-0.0209502, 0.00482749, 0.00396559, -0.00700407, -0.000948162, 0.00224162, 0.000818391, 0.00206919}, 
{-0.0251281, 0.00624545, 0.00461199, -0.00780564, -0.00141417, 0.00276913, 0.000778548, 0.00316143}, 
{-0.0302946, 0.00866497, 0.00521223, -0.00988902, -0.00204733, 0.00405515, 0.00050972, 0.00423722}, 
{-0.0408183, 0.0135754, 0.00660996, -0.012319, -0.0026003, 0.00620166, 0.000715322, 0.00782959}}; 
double meanQyPlus[nCentBin][nHarmonics] = {{0.000994398, 0.000539071, 0.00530563, -0.0037491, 0.00050277, 0.00198663, -0.000678795, 0.00109984}, 
{0.00136429, 0.000761838, 0.00508862, -0.00378626, 0.000207789, 0.00207685, -0.000968002, 0.000704379}, 
{0.00196364, 0.00119855, 0.00465904, -0.00369022, -5.60483e-05, 0.00186885, -0.00106452, 0.00034104}, 
{0.00270744, 0.00161511, 0.00411279, -0.00347442, -0.000367243, 0.00129578, -0.00092186, -0.000134664}, 
{0.00473578, 0.00308921, 0.00247286, -0.00249582, -0.00114453, -0.000234597, -0.000642883, -0.00126458}, 
{0.00704083, 0.00440321, 0.000591041, -0.00110804, -0.00215031, -0.00205578, -0.000208312, -0.00279927}, 
{0.00761135, 0.00533007, -0.000348041, -0.000462229, -0.00243977, -0.00272779, -0.000246189, -0.00386048}, 
{0.009119, 0.00679714, -0.00106753, 0.000286798, -0.00297008, -0.00405543, -5.46964e-05, -0.00473728}, 
{0.011194, 0.00815954, -0.00234946, 0.000763707, -0.00359399, -0.00500221, 0.000365159, -0.00585437}, 
{0.0128447, 0.00977617, -0.00434691, 0.00219013, -0.00463681, -0.00710591, 0.000507074, -0.00718298}, 
{0.0152733, 0.011035, -0.00692109, 0.00319239, -0.00531191, -0.0093124, 0.000764628, -0.00858527}, 
{0.0173273, 0.0142676, -0.00925567, 0.00512159, -0.00704768, -0.0107264, 0.00122253, -0.0107459}, 
{0.0211561, 0.0166698, -0.0121473, 0.00687379, -0.0082283, -0.0138632, 0.00227028, -0.0133674}, 
{0.027695, 0.0214733, -0.017834, 0.0107672, -0.0111661, -0.0192567, 0.0025855, -0.0184527}}; 
double meanQxMinus[nCentBin][nHarmonics] = {{-0.00745326, -0.00337436, 9.23401e-06, 9.9715e-06, -0.000193807, -0.000393263, 0.00286336, 0.00246631}, 
{-0.00730594, -0.0035378, -1.01208e-05, -1.30661e-05, -0.000190386, -0.000418015, 0.00257251, 0.00236177}, 
{-0.00695771, -0.00374782, -0.00024197, -0.000331435, -0.000220581, -0.000537693, 0.00200355, 0.00222039}, 
{-0.00674159, -0.00379514, -0.000483607, -0.000518096, -0.00012062, -0.000701405, 0.00154138, 0.00206291}, 
{-0.00627359, -0.00374201, -0.00114292, -0.000818172, 0.000108387, -0.00122879, 3.06238e-05, 0.00171711}, 
{-0.00532443, -0.0042206, -0.00163945, -0.00120659, 0.000267573, -0.00219705, -0.00196065, 0.00108968}, 
{-0.00496571, -0.00403796, -0.00170162, -0.00197436, 0.000331103, -0.00227686, -0.00291941, 0.000870692}, 
{-0.00464043, -0.0038123, -0.00248582, -0.00197921, 0.000677053, -0.00290754, -0.00388505, 0.000725392}, 
{-0.00416013, -0.00432232, -0.00246314, -0.00274077, 0.00077251, -0.00310692, -0.00541782, 0.000578477}, 
{-0.00370147, -0.00438245, -0.00335681, -0.00301257, 0.000986969, -0.00435414, -0.00717998, -0.000450184}, 
{-0.00258824, -0.0040922, -0.00344245, -0.00380189, 0.00111607, -0.00451405, -0.00974005, -0.000530204}, 
{-0.00176043, -0.0039319, -0.00476302, -0.00442076, 0.0018464, -0.00597039, -0.0124218, -0.00167987}, 
{-0.000469571, -0.00377312, -0.00560623, -0.00478386, 0.00225277, -0.00676532, -0.0156772, -0.00235061}, 
{0.00272304, -0.00410323, -0.00694679, -0.00679388, 0.00311219, -0.0100562, -0.0220971, -0.00421948}}; 
double meanQyMinus[nCentBin][nHarmonics] = {{0.000299222, -5.39207e-06, 0.0014912, 0.000165625, 0.000672397, -0.00181286, -0.00111121, -1.63172e-05}, 
{0.000589987, 0.000278117, 0.00147172, 0.000213089, 0.00083332, -0.00174097, -0.000944281, 7.84493e-05}, 
{0.00107467, 0.000798805, 0.00178321, 0.000402701, 0.000909587, -0.00169633, -0.000385308, 0.000219093}, 
{0.00161104, 0.00117913, 0.00199403, 0.000533865, 0.00125066, -0.00160416, 0.000239512, 0.000523676}, 
{0.00270705, 0.00232413, 0.00235017, 0.000699857, 0.00186997, -0.00158218, 0.0017982, 0.00107179}, 
{0.00418006, 0.00387489, 0.00261142, 0.000877131, 0.00257486, -0.00144677, 0.00386931, 0.00171808}, 
{0.00495454, 0.00406609, 0.00363326, 0.00133083, 0.00296902, -0.00132149, 0.00459741, 0.00194374}, 
{0.00584633, 0.00510497, 0.00379559, 0.00134777, 0.00401104, -0.00169502, 0.00613801, 0.00213683}, 
{0.00693737, 0.00549378, 0.00386376, 0.00145973, 0.00416905, -0.00129711, 0.00729101, 0.00330163}, 
{0.00858031, 0.00750283, 0.00498727, 0.00162749, 0.00519946, -0.00098371, 0.00915811, 0.00386009}, 
{0.00992891, 0.00839032, 0.00508602, 0.00155922, 0.00632363, -0.000871299, 0.0116226, 0.00465404}, 
{0.0114041, 0.0105982, 0.00618654, 0.00245817, 0.0075665, -0.000758188, 0.0142671, 0.00564353}, 
{0.0145732, 0.0120635, 0.00740021, 0.00237909, 0.00897993, -0.00129981, 0.0174415, 0.00678623}, 
{0.0195512, 0.0175299, 0.00934478, 0.00371474, 0.0121593, -0.000443913, 0.0247465, 0.00962592}};
*/

double meanQxPlus[nCentBin][nHarmonics] = {{0.00200236, -0.00406508, 0.000250793, -0.000878414, 0.000973402, -0.0014809, 0.000913733, -0.00401897}, 
{0.00188878, -0.0040178, 0.000300411, -0.00105337, 0.00102812, -0.00141349, 0.000928714, -0.00403762}, 
{0.00175464, -0.00395991, 0.000378749, -0.00111462, 0.00106781, -0.00138677, 0.000939554, -0.00404412}, 
{0.00161756, -0.00411756, 0.000380666, -0.00123549, 0.00107, -0.00134095, 0.000947167, -0.00399925}, 
{0.00148418, -0.00420144, 0.000394423, -0.0012862, 0.00111963, -0.00133198, 0.000910332, -0.0039705}, 
{0.00129798, -0.00401025, 0.00044777, -0.00133899, 0.00110081, -0.00137043, 0.000923457, -0.00395742}, 
{0.00115697, -0.00415826, 0.000444132, -0.00144394, 0.00108188, -0.00136238, 0.000885464, -0.00392704}, 
{0.000954552, -0.00396605, 0.000441967, -0.00144882, 0.00100456, -0.00130212, 0.000854507, -0.00386614}, 
{0.000688532, -0.00390173, 0.000390223, -0.0015459, 0.00108873, -0.00133809, 0.000853363, -0.00378115}, 
{0.000187732, -0.003793, 0.000482009, -0.00164686, 0.000989158, -0.00127643, 0.000910094, -0.00365506}, 
{-0.00107391, -0.00337577, 0.000648772, -0.00188986, 0.000862653, -0.00104483, 0.000907858, -0.00340954}, 
{-0.00406633, -0.00215127, 0.00100399, -0.00273999, 0.000527388, -0.000575909, 0.000774848, -0.00272037}, 
{-0.0119146, 0.000772466, 0.00220632, -0.00468756, -6.54767e-05, 0.000749651, 0.0008515, -0.000683961}, 
{-0.0305669, 0.00884766, 0.00524157, -0.00962517, -0.00185202, 0.00407538, 0.000762954, 0.00472005}}; 
double meanQyPlus[nCentBin][nHarmonics] = {{0.000992821, 0.000547776, 0.00530253, -0.00375322, 0.000494379, 0.00199003, -0.000679733, 0.00110376}, 
{0.00109642, 0.000544715, 0.0052691, -0.0038008, 0.000402422, 0.00201073, -0.000747801, 0.000977373}, 
{0.00116354, 0.000625101, 0.00524865, -0.00378419, 0.00038179, 0.00210444, -0.000824079, 0.000917186}, 
{0.00122382, 0.000615136, 0.00515, -0.00378928, 0.000294939, 0.00213081, -0.000873014, 0.000813093}, 
{0.00129281, 0.000596829, 0.00514504, -0.00380143, 0.000253691, 0.00212093, -0.000886513, 0.000710894}, 
{0.00131141, 0.000655444, 0.0051454, -0.00380952, 0.000190203, 0.00209555, -0.000993938, 0.000685178}, 
{0.00144155, 0.000799624, 0.00504312, -0.00376827, 0.000189656, 0.00212096, -0.00106744, 0.000625664}, 
{0.00143652, 0.00105113, 0.00494707, -0.00379822, 3.23603e-05, 0.00210414, -0.00111172, 0.000573328}, 
{0.00164384, 0.000962302, 0.00492041, -0.00375909, 3.84601e-05, 0.00201955, -0.00110273, 0.000516423}, 
{0.00197431, 0.00116052, 0.00465423, -0.00369376, -8.55707e-05, 0.00185651, -0.00106798, 0.000355243}, 
{0.00268979, 0.00161769, 0.00412424, -0.00347438, -0.00034958, 0.00130426, -0.000938353, -0.000145289}, 
{0.00472169, 0.0030668, 0.00247882, -0.00254784, -0.00115993, -0.00027556, -0.000656106, -0.00131883}, 
{0.00952328, 0.00693346, -0.00146238, 0.000318293, -0.00318555, -0.00421044, 3.48638e-05, -0.00492544}, 
{0.0211416, 0.0164548, -0.0121734, 0.00696396, -0.00831621, -0.0139357, 0.00182894, -0.0134529}}; 
double meanQxMinus[nCentBin][nHarmonics] = {{-0.00744128, -0.00337244, 1.48212e-05, 5.42641e-06, -0.000200626, -0.00038433, 0.00286437, 0.00246257}, 
{-0.00743045, -0.0033391, -4.82623e-05, 5.72478e-05, -0.000210233, -0.000385657, 0.00283456, 0.00245267}, 
{-0.00741129, -0.00336099, 4.20331e-05, 8.28e-05, -0.000219253, -0.000417237, 0.00282414, 0.00241437}, 
{-0.00734531, -0.00347981, 6.08852e-05, 0.000123262, -0.000173554, -0.000375635, 0.00275259, 0.00241756}, 
{-0.00740022, -0.00357793, 0.000103762, 8.19615e-05, -0.000194003, -0.000407388, 0.00274062, 0.00237243}, 
{-0.00726633, -0.00345539, 5.8544e-05, 6.16727e-05, -0.000200243, -0.000399433, 0.00260023, 0.00234502}, 
{-0.0072685, -0.00368267, 2.13712e-05, 1.22865e-05, -0.000156424, -0.000378482, 0.00254256, 0.00232313}, 
{-0.00727223, -0.00360801, -1.78692e-05, -8.07809e-05, -0.000169787, -0.000434713, 0.00240552, 0.00230693}, 
{-0.00721212, -0.00366464, -0.000119813, -0.00021066, -0.000206851, -0.000459121, 0.002246, 0.0022797}, 
{-0.00698496, -0.00376091, -0.0002322, -0.000326695, -0.000216265, -0.000544229, 0.00200393, 0.00223484}, 
{-0.0067256, -0.0037688, -0.000478703, -0.000506688, -0.000125578, -0.000728614, 0.00154118, 0.00205028}, 
{-0.00627931, -0.00372106, -0.00115202, -0.000804232, 5.73532e-05, -0.00125365, 3.13764e-05, 0.00171922}, 
{-0.00447969, -0.00417714, -0.00236665, -0.00218983, 0.00063352, -0.00295359, -0.00431624, 0.000520542}, 
{-0.000183382, -0.00397922, -0.00546565, -0.00512445, 0.00217043, -0.00715614, -0.0157634, -0.00242676}}; 
double meanQyMinus[nCentBin][nHarmonics] = {{0.000288839, -4.57013e-06, 0.00149893, 0.000164769, 0.000665783, -0.00181216, -0.00111407, -1.59578e-05}, 
{0.000276545, 2.89835e-05, 0.00149304, 0.000165748, 0.000749661, -0.0018176, -0.0010858, 2.18127e-05}, 
{0.000356997, 7.98346e-05, 0.00146912, 0.00021831, 0.000770117, -0.00176795, -0.00111429, 1.10624e-05}, 
{0.000420758, 8.10617e-05, 0.00138574, 0.000153252, 0.000799184, -0.00179271, -0.00106003, -1.60601e-05}, 
{0.000466504, 0.000163446, 0.00142098, 0.000204563, 0.00083679, -0.00177631, -0.00107409, 3.92837e-05}, 
{0.000619232, 0.000237043, 0.00146791, 0.000220692, 0.000843705, -0.00176187, -0.000986338, 9.13662e-05}, 
{0.000681725, 0.000292151, 0.0014463, 0.00028754, 0.000826261, -0.00175047, -0.000900191, 8.53244e-05}, 
{0.000758114, 0.000603423, 0.00148535, 0.000178767, 0.000798959, -0.00168713, -0.000848155, 0.00010283}, 
{0.000884479, 0.000544204, 0.00154626, 0.000257611, 0.000934999, -0.00162859, -0.000719048, 0.000196281}, 
{0.0010585, 0.0007883, 0.00175912, 0.000414995, 0.000927226, -0.00168902, -0.00038009, 0.00021886}, 
{0.00164606, 0.00115329, 0.00201386, 0.000506996, 0.00127786, -0.00161914, 0.000245362, 0.000497576}, 
{0.00272377, 0.00234488, 0.00236751, 0.000700936, 0.00184024, -0.00158843, 0.00179761, 0.00106989}, 
{0.00608512, 0.00523232, 0.00378564, 0.00133845, 0.00380261, -0.0014072, 0.00618146, 0.00257627}, 
{0.0145587, 0.012768, 0.00719656, 0.00263844, 0.0090506, -0.000751369, 0.0178617, 0.00695593}};





